<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AB AAS API Tester</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #F1EFCE;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #C03825;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        .section {
            background: white;
            border: 2px solid #CCB256;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        h2 {
            color: #C03825;
            margin-bottom: 15px;
            border-bottom: 2px solid #CCB256;
            padding-bottom: 10px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #C03825;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #CCB256;
            border-radius: 4px;
            font-size: 14px;
        }
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #C03825;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-right: 10px;
            margin-top: 10px;
        }
        button:hover {
            background: #a02f1f;
        }
        button.secondary {
            background: #CCB256;
        }
        button.secondary:hover {
            background: #b39d45;
        }
        .response {
            background: #f5f5f5;
            border: 2px solid #CCB256;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .response pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .success {
            border-color: #4CAF50;
            background: #e8f5e9;
        }
        .error {
            border-color: #f44336;
            background: #ffebee;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        .beneficiary-card {
            background: #F1EFCE;
            border: 2px solid #CCB256;
            border-radius: 8px;
            padding: 15px;
        }
        .beneficiary-card h3 {
            color: #C03825;
            margin-bottom: 10px;
        }
        .beneficiary-card p {
            margin: 5px 0;
            font-size: 14px;
        }
        .beneficiary-card .actions {
            margin-top: 10px;
        }
        .beneficiary-card button {
            padding: 8px 16px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• AB AAS API Tester</h1>

        <!-- Registration -->
        <div class="section">
            <h2>üìù Register Beneficiary (Check & Create)</h2>
            <p style="color: #666; margin-bottom: 15px; font-size: 14px;">
                This endpoint checks if a phone number is already registered. If yes, returns existing details. If no, creates new registration.
            </p>
            <div class="grid">
                <div class="form-group">
                    <label>Name: *</label>
                    <input type="text" id="regName" placeholder="Full Name">
                </div>
                <div class="form-group">
                    <label>Phone Number: *</label>
                    <input type="text" id="regPhone" placeholder="10-digit number">
                </div>
                <div class="form-group">
                    <label>Date of Birth: *</label>
                    <input type="text" id="regDob" placeholder="DD/MM/YYYY">
                </div>
                <div class="form-group">
                    <label>Disability Type: *</label>
                    <input type="text" id="regDisability" placeholder="Type of disability">
                </div>
                <div class="form-group">
                    <label>Disability Percentage: *</label>
                    <input type="text" id="regPercentage" placeholder="e.g., 75%">
                </div>
                <div class="form-group">
                    <label>Marital Status:</label>
                    <input type="text" id="regMarital" placeholder="Married/Single">
                </div>
            </div>
            <div class="form-group">
                <label>Address:</label>
                <textarea id="regAddress" placeholder="Full address"></textarea>
            </div>
            <div class="form-group">
                <label>Comments:</label>
                <textarea id="regComments" placeholder="Additional notes"></textarea>
            </div>
            <button onclick="registerBeneficiary()">Register / Check Existing</button>
            <button class="secondary" onclick="clearRegisterForm()">Clear Form</button>
            <div id="registerResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Fetch All -->
        <div class="section">
            <h2>üìã Fetch All Beneficiaries</h2>
            <button onclick="fetchAll()">Fetch All</button>
            <button class="secondary" onclick="clearResponse('fetchAllResponse')">Clear</button>
            <div id="fetchAllResponse" class="response" style="display:none;"></div>
            <div id="beneficiariesList" class="grid" style="margin-top: 20px;"></div>
        </div>

        <!-- Fetch Single -->
        <div class="section">
            <h2>üîç Fetch Single Beneficiary</h2>
            <div class="form-group">
                <label>Beneficiary ID:</label>
                <input type="text" id="fetchId" placeholder="Enter MongoDB ObjectId">
            </div>
            <button onclick="fetchSingle()">Fetch Single</button>
            <button class="secondary" onclick="clearResponse('fetchSingleResponse')">Clear</button>
            <div id="fetchSingleResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Create New -->
        <div class="section">
            <h2>‚ûï Create New Beneficiary</h2>
            <div class="grid">
                <div class="form-group">
                    <label>Name: *</label>
                    <input type="text" id="createName" placeholder="Full Name">
                </div>
                <div class="form-group">
                    <label>Phone Number: *</label>
                    <input type="text" id="createPhone" placeholder="10-digit number">
                </div>
                <div class="form-group">
                    <label>Date of Birth:</label>
                    <input type="text" id="createDob" placeholder="DD/MM/YYYY">
                </div>
                <div class="form-group">
                    <label>Marital Status:</label>
                    <input type="text" id="createMarital" placeholder="Married/Single">
                </div>
                <div class="form-group">
                    <label>Disability Type:</label>
                    <input type="text" id="createDisability" placeholder="Type of disability">
                </div>
                <div class="form-group">
                    <label>Disability Percentage:</label>
                    <input type="text" id="createPercentage" placeholder="e.g., 75%">
                </div>
            </div>
            <div class="form-group">
                <label>Address:</label>
                <textarea id="createAddress" placeholder="Full address"></textarea>
            </div>
            <div class="form-group">
                <label>Comments:</label>
                <textarea id="createComments" placeholder="Additional notes"></textarea>
            </div>
            <button onclick="createBeneficiary()">Create Beneficiary</button>
            <button class="secondary" onclick="clearCreateForm()">Clear Form</button>
            <div id="createResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Update -->
        <div class="section">
            <h2>‚úèÔ∏è Update Beneficiary</h2>
            <div class="form-group">
                <label>Beneficiary ID: *</label>
                <input type="text" id="updateId" placeholder="Enter MongoDB ObjectId">
            </div>
            <div class="grid">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="updateName" placeholder="New name">
                </div>
                <div class="form-group">
                    <label>Phone Number:</label>
                    <input type="text" id="updatePhone" placeholder="New phone">
                </div>
                <div class="form-group">
                    <label>Date of Birth:</label>
                    <input type="text" id="updateDob" placeholder="DD/MM/YYYY">
                </div>
                <div class="form-group">
                    <label>Marital Status:</label>
                    <input type="text" id="updateMarital" placeholder="Married/Single">
                </div>
            </div>
            <div class="form-group">
                <label>Address:</label>
                <textarea id="updateAddress" placeholder="New address"></textarea>
            </div>
            <div class="form-group">
                <label>Comments:</label>
                <textarea id="updateComments" placeholder="Updated notes"></textarea>
            </div>
            <button onclick="updateBeneficiary()">Update Beneficiary</button>
            <button class="secondary" onclick="clearUpdateForm()">Clear Form</button>
            <div id="updateResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Delete -->
        <div class="section">
            <h2>üóëÔ∏è Delete Beneficiary</h2>
            <div class="form-group">
                <label>Beneficiary ID:</label>
                <input type="text" id="deleteId" placeholder="Enter MongoDB ObjectId">
            </div>
            <button onclick="deleteBeneficiary()">Delete Beneficiary</button>
            <button class="secondary" onclick="clearResponse('deleteResponse')">Clear</button>
            <div id="deleteResponse" class="response" style="display:none;"></div>
        </div>
    </div>

    <script>
        const API_URL = '/api/abaas';
        const REGISTER_URL = '/api/register';

        function showResponse(elementId, data, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = 'response ' + (isError ? 'error' : 'success');
            element.innerHTML = '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
        }

        function clearResponse(elementId) {
            const element = document.getElementById(elementId);
            element.style.display = 'none';
            element.innerHTML = '';
        }

        async function fetchAll() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                showResponse('fetchAllResponse', data, !data.success);
                
                if (data.success && data.data) {
                    displayBeneficiaries(data.data);
                }
            } catch (error) {
                showResponse('fetchAllResponse', { error: error.message }, true);
            }
        }

        function displayBeneficiaries(beneficiaries) {
            const container = document.getElementById('beneficiariesList');
            container.innerHTML = '';
            
            beneficiaries.forEach(b => {
                const card = document.createElement('div');
                card.className = 'beneficiary-card';
                card.innerHTML = `
                    <h3>${b.name}</h3>
                    <p><strong>Phone:</strong> ${b.phoneNumber}</p>
                    <p><strong>DOB:</strong> ${b.dob}</p>
                    <p><strong>Address:</strong> ${b.address}</p>
                    <p><strong>Disability:</strong> ${b.disabilityType} (${b.disabilityPercentage})</p>
                    <p><strong>Marital Status:</strong> ${b.maritalStatus}</p>
                    <div class="actions">
                        <button onclick="loadForUpdate('${b.id}')">Edit</button>
                        <button onclick="confirmDelete('${b.id}')">Delete</button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        async function fetchSingle() {
            const id = document.getElementById('fetchId').value;
            if (!id) {
                alert('Please enter a beneficiary ID');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}?id=${id}`);
                const data = await response.json();
                showResponse('fetchSingleResponse', data, !data.success);
            } catch (error) {
                showResponse('fetchSingleResponse', { error: error.message }, true);
            }
        }

        async function createBeneficiary() {
            const name = document.getElementById('createName').value;
            const phoneNumber = document.getElementById('createPhone').value;
            
            if (!name || !phoneNumber) {
                alert('Name and Phone Number are required');
                return;
            }
            
            const data = {
                name,
                phoneNumber,
                dob: document.getElementById('createDob').value,
                address: document.getElementById('createAddress').value,
                disabilityType: document.getElementById('createDisability').value,
                disabilityPercentage: document.getElementById('createPercentage').value,
                maritalStatus: document.getElementById('createMarital').value,
                comments: document.getElementById('createComments').value,
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('createResponse', result, !result.success);
                
                if (result.success) {
                    clearCreateForm();
                    fetchAll(); // Refresh the list
                }
            } catch (error) {
                showResponse('createResponse', { error: error.message }, true);
            }
        }

        async function updateBeneficiary() {
            const id = document.getElementById('updateId').value;
            if (!id) {
                alert('Please enter a beneficiary ID');
                return;
            }
            
            const data = { id };
            
            const name = document.getElementById('updateName').value;
            const phoneNumber = document.getElementById('updatePhone').value;
            const dob = document.getElementById('updateDob').value;
            const address = document.getElementById('updateAddress').value;
            const maritalStatus = document.getElementById('updateMarital').value;
            const comments = document.getElementById('updateComments').value;
            
            if (name) data.name = name;
            if (phoneNumber) data.phoneNumber = phoneNumber;
            if (dob) data.dob = dob;
            if (address) data.address = address;
            if (maritalStatus) data.maritalStatus = maritalStatus;
            if (comments) data.comments = comments;
            
            try {
                const response = await fetch(API_URL, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('updateResponse', result, !result.success);
                
                if (result.success) {
                    fetchAll(); // Refresh the list
                }
            } catch (error) {
                showResponse('updateResponse', { error: error.message }, true);
            }
        }

        async function deleteBeneficiary() {
            const id = document.getElementById('deleteId').value;
            if (!id) {
                alert('Please enter a beneficiary ID');
                return;
            }
            
            if (!confirm('Are you sure you want to delete this beneficiary?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}?id=${id}`, {
                    method: 'DELETE'
                });
                const data = await response.json();
                showResponse('deleteResponse', data, !data.success);
                
                if (data.success) {
                    document.getElementById('deleteId').value = '';
                    fetchAll(); // Refresh the list
                }
            } catch (error) {
                showResponse('deleteResponse', { error: error.message }, true);
            }
        }

        function loadForUpdate(id) {
            document.getElementById('updateId').value = id;
            window.scrollTo({ top: document.querySelector('h2:nth-of-type(4)').offsetTop - 20, behavior: 'smooth' });
        }

        function confirmDelete(id) {
            document.getElementById('deleteId').value = id;
            window.scrollTo({ top: document.querySelector('h2:nth-of-type(5)').offsetTop - 20, behavior: 'smooth' });
        }

        function clearCreateForm() {
            document.getElementById('createName').value = '';
            document.getElementById('createPhone').value = '';
            document.getElementById('createDob').value = '';
            document.getElementById('createAddress').value = '';
            document.getElementById('createDisability').value = '';
            document.getElementById('createPercentage').value = '';
            document.getElementById('createMarital').value = '';
            document.getElementById('createComments').value = '';
            clearResponse('createResponse');
        }

        function clearUpdateForm() {
            document.getElementById('updateId').value = '';
            document.getElementById('updateName').value = '';
            document.getElementById('updatePhone').value = '';
            document.getElementById('updateDob').value = '';
            document.getElementById('updateAddress').value = '';
            document.getElementById('updateMarital').value = '';
            document.getElementById('updateComments').value = '';
            clearResponse('updateResponse');
        }

        async function registerBeneficiary() {
            const name = document.getElementById('regName').value;
            const phoneNumber = document.getElementById('regPhone').value;
            const dob = document.getElementById('regDob').value;
            const disabilityType = document.getElementById('regDisability').value;
            const disabilityPercentage = document.getElementById('regPercentage').value;
            
            if (!name || !phoneNumber || !dob || !disabilityType || !disabilityPercentage) {
                alert('All required fields must be filled: Name, Phone, DOB, Disability Type, and Percentage');
                return;
            }
            
            const data = {
                name,
                phoneNumber,
                dob,
                disabilityType,
                disabilityPercentage,
                address: document.getElementById('regAddress').value,
                maritalStatus: document.getElementById('regMarital').value,
                comments: document.getElementById('regComments').value,
            };
            
            try {
                const response = await fetch(REGISTER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                showResponse('registerResponse', result, !result.success);
                
                if (result.success) {
                    if (result.userExists) {
                        alert('User already registered! Showing existing details.');
                    } else {
                        alert('Registration successful!');
                        clearRegisterForm();
                    }
                    fetchAll(); // Refresh the list
                }
            } catch (error) {
                showResponse('registerResponse', { error: error.message }, true);
            }
        }

        function clearRegisterForm() {
            document.getElementById('regName').value = '';
            document.getElementById('regPhone').value = '';
            document.getElementById('regDob').value = '';
            document.getElementById('regDisability').value = '';
            document.getElementById('regPercentage').value = '';
            document.getElementById('regMarital').value = '';
            document.getElementById('regAddress').value = '';
            document.getElementById('regComments').value = '';
            clearResponse('registerResponse');
        }

        // Auto-fetch on page load
        window.onload = () => {
            fetchAll();
        };
    </script>
</body>
</html>
